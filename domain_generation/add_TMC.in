# Delete TMC
delete_atoms group UNXLINKED_TMC

# Refresh - just in case
group chlorine delete
group XLINKED_ATOMS delete
group UNXLINKED_ATOMS delete
group UNXLINKED_TMC delete


# Add in new TMC molecules 
label tmc_pack_loop_2
variable pp loop 1000
variable TMC_mol_count_to_add equal (${atom_count}-$(atoms))/18
print "TMC molecules needed to be added ${TMC_mol_count_to_add} Loop ${pp}"
create_atoms 0 box subset ${TMC_mol_count_to_add} $(5221*v_pp*v_rand) mol TMCmol 325132

group chlorine type 18
group XLINKED_ATOMS variable atom_charge_xlinked
group XLINKED_ATOMS include molecule
group UNXLINKED_ATOMS subtract all XLINKED_ATOMS
group UNXLINKED_TMC intersect UNXLINKED_ATOMS chlorine
group UNXLINKED_TMC include molecule


print "Number of atoms in TMCs group: $(count(UNXLINKED_TMC))"
delete_atoms overlap 1.0 UNXLINKED_TMC all mol yes
fix 1 all nve
run 0
unfix 1
if "$(atoms) == ${atom_count}" then "jump SELF tmc_pack_break_2"
next pp
jump SELF tmc_pack_loop_2

label tmc_pack_break_2
reset_atoms id

# Minimize after add TMC Molecules 
dielectric       1.0
neighbor         2.0 bin
neigh_modify     delay 0 every 1 check yes
timestep         10.0
run_style        verlet
# Minimization Step
min_style        sd
minimize         1.0e-5 1.0e-5 10000 100000
min_style        cg
min_modify       line quadratic
minimize         1.0e-8 1.0e-8 10000 100000

# Reset the timestep
timestep 1.0
